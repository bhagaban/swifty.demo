---
functions:
- name: '%name%.base'
  sources:
    type: git
    repo: https://github.com/swiftycloud/swifty.demo//functions/golang/simple-user-mgmt.go
  code:
    lang: golang
    env:
    - 'SWIFTY_AUTH_NAME=%name%'
  mware:
  - '%name%_jwt'
  - '%name%_mgo'
- name: '%name%.fb'
  sources:
    type: git
    repo: https://github.com/swiftycloud/swifty.demo//functions/golang/facebook-user-mgmt.go
  code:
    lang: golang
    env:
    - 'SWIFTY_AUTH_NAME=%name%'
  mware:
  - '%name%_jwt'
  - '%name%_mgo'
  accounts:
  - 'facebook:%name%'
- name: '%name%.link'
  sources:
    type: git
    repo: https://github.com/swiftycloud/swifty.demo//functions/golang/user-accounts-link.go
  code:
    lang: golang
    env:
    - 'SWIFTY_AUTH_NAME=%name%'
  mware:
  - '%name%_mgo'
  accounts:
  - 'facebook:%name%'
  authctx: '%name%_jwt'
- name: '%name%.profile'
  sources:
    type: git
    repo: https://github.com/swiftycloud/swifty.demo//functions/golang/simple-profile-mgmt.go
  code:
    lang: golang
    env:
    - 'SWIFTY_AUTH_NAME=%name%'
  mware:
  - '%name%_profiles'
  authctx: '%name%_jwt'
routers:
- name: '%name%'
  table:
  - method: POST
    path: signup
    call: '%name%.base'
  - method: POST
    path: signin
    call: '%name%.base'
  - method: POST
    path: signin_fb
    call: '%name%.fb'
  - method: POST
    path: link
    call: '%name%.link'
  - method: POST
    path: leave
    call: '%name%.base'
  - method: '*'
    path: profile
    call: '%name%.profile'
mwares:
- name: '%name%_jwt'
  type: authjwt
- name: '%name%_mgo'
  type: mongo
- name: '%name%_profiles'
  type: mongo
